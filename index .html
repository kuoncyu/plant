<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°ç£å¸¸è¦‹æ¤ç‰©åœ–é‘‘ (æ¯æ—¥ä¸€æ¤ç‰ˆ)</title>
    <style>
        :root {
            --primary: #2e7d32;
            --secondary: #66bb6a;
            --accent: #fdd835;
            --bg: #f1f8e9;
            --text: #333333;
            --card-bg: #ffffff;
            
            /* ç‹€æ…‹æ¨™ç±¤é¡è‰² */
            --status-common: #558b2f;  /* å¸¸è¦‹ï¼šè‰ç¶  */
            --status-endemic: #7b1fa2; /* ç‰¹æœ‰ç¨®ï¼šç´« */
            --status-poison: #c62828;  /* æœ‰æ¯’/è­¦ç¤ºï¼šç´… */
            --status-tree: #795548;    /* æœ¨æœ¬/æ¨¹ï¼šè¤ */
            --status-alien: #616161;   /* å¤–ä¾†ç¨®ï¼šç° */
            --status-food: #f57f17;    /* é£Ÿç”¨ï¼šæ©˜ */
            --status-water: #0277bd;   /* æ°´ç”Ÿï¼šè— */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: "Noto Sans TC", "Microsoft JhengHei", -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            padding-bottom: 80px;
            overflow-x: hidden;
        }

        /* --- Header --- */
        header {
            background: linear-gradient(135deg, #1b5e20, #388e3c);
            color: white;
            padding: 1.2rem 1rem;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            position: sticky; top: 0;
            z-index: 100;
        }
        h1 { margin: 0; font-size: 1.5rem; letter-spacing: 1.5px; }
        .subtitle { font-size: 0.8rem; opacity: 0.9; margin-top: 5px; }

        /* --- Navigation --- */
        .nav {
            display: flex;
            justify-content: flex-start;
            gap: 10px; 
            padding: 10px 15px;
            background: white; 
            border-bottom: 1px solid #c8e6c9;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: sticky;
            top: 78px; z-index: 90;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .nav::-webkit-scrollbar { display: none; }
        
        .nav-btn {
            padding: 8px 18px;
            border: none; border-radius: 50px;
            background: #eceff1; color: #546e7a; cursor: pointer;
            font-weight: bold; transition: all 0.2s; 
            font-size: 0.9rem; white-space: nowrap;
            flex-shrink: 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .nav-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 5px rgba(46, 125, 50, 0.4);
        }

        .container { 
            max-width: 1000px;
            margin: 0 auto; padding: 15px; 
            min-height: 80vh;
        }
        .section { display: none; animation: fadeIn 0.3s ease-out; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Daily Card --- */
        .daily-container { width: 100%; max-width: 480px; margin: 0 auto; text-align: center; }
        
        .card-scene {
            perspective: 1000px;
            width: 100%; 
            height: min(580px, 65vh);
            margin: 20px auto; 
            position: relative;
        }
        .card-inner {
            position: relative;
            width: 100%; height: 100%; text-align: center;
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            transform-style: preserve-3d;
        }
        .card-inner.is-flipped { transform: rotateY(180deg); }
        
        .card-face {
            position: absolute;
            width: 100%; height: 100%;
            backface-visibility: hidden; 
            -webkit-backface-visibility: hidden;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            overflow: hidden;
            background: white;
        }
        
        .card-front {
            background: linear-gradient(135deg, #43a047, #66bb6a);
            color: white; border: 4px solid #e8f5e9;
            z-index: 2;
            cursor: pointer;
        }
        .card-back {
            transform: rotateY(180deg);
            padding: 0; justify-content: flex-start;
            border: 1px solid #ddd;
            background: #fdfdfd;
            z-index: 1;
        }
        
        .daily-img-wrapper { 
            width: 100%;
            height: 55%; 
            background: #1b1b1b; 
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: zoom-in;
        }
        .daily-img { 
            width: 100%;
            height: 100%; 
            object-fit: contain; 
            display: block;
        }
        .zoom-hint {
            position: absolute;
            bottom: 10px; right: 10px;
            background: rgba(0,0,0,0.6);
            color: white; padding: 6px 10px;
            border-radius: 20px; font-size: 0.75rem;
            pointer-events: none;
            display: flex; align-items: center; gap: 5px;
        }

        .daily-info-box { 
            padding: 20px;
            text-align: left; height: 45%; 
            overflow-y: auto; box-sizing: border-box; 
            -webkit-overflow-scrolling: touch;
        }
        .daily-date { 
            background: rgba(0,0,0,0.2);
            padding: 5px 15px; border-radius: 20px; 
            margin-bottom: 20px; font-size: 0.9rem; letter-spacing: 1px;
        }

        /* --- Tools & Grid --- */
        .tools-bar {
            background: white;
            padding: 15px; border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px;
            border: 1px solid #dcedc8;
        }
        .search-box {
            width: 100%;
            padding: 10px; border: 2px solid #c5e1a5;
            border-radius: 8px; font-size: 1rem; box-sizing: border-box; margin-bottom: 12px;
            -webkit-appearance: none;
        }
        .filter-scroll { 
            display: flex;
            gap: 8px; overflow-x: auto; padding-bottom: 5px; 
            scrollbar-width: none; -webkit-overflow-scrolling: touch;
        }
        .filter-tag {
            white-space: nowrap;
            padding: 6px 14px; border-radius: 15px;
            background: #f1f8e9; border: 1px solid #a5d6a7; cursor: pointer; 
            font-size: 0.85rem; color: #33691e; flex-shrink: 0;
        }
        .filter-tag.active { background: var(--primary); color: white; border-color: var(--primary); }

        .plant-grid { 
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px; 
        }
        .plant-card {
            background: var(--card-bg);
            border-radius: 12px; padding: 15px 10px; text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; 
            border: 1px solid #f1f1f1;
            display: flex;
            flex-direction: column; justify-content: center; min-height: 110px;
            position: relative;
        }
        @media (hover: hover) {
            .plant-card:hover { transform: translateY(-5px);
            border-color: var(--secondary); box-shadow: 0 10px 15px -5px rgba(0,0,0,0.1); transition: 0.2s;
            }
        }
        .plant-card:active { transform: scale(0.98); background: #f9f9f9; }

        .p-name { font-weight: bold; font-size: 1rem; color: #1b5e20; margin-bottom: 5px; }
        .p-cat { font-size: 0.75rem; color: #558b2f; margin-bottom: 8px; }
        
        .status-badge {
            font-size: 0.7rem;
            color: white; padding: 3px 8px; border-radius: 10px;
            display: inline-block; font-weight: bold; margin-top: auto;
        }
        .st-endemic { background: var(--status-endemic); }
        .st-common { background: var(--status-common); }
        .st-poison { background: var(--status-poison); }
        .st-tree { background: var(--status-tree); }
        .st-alien { background: var(--status-alien); }
        .st-food { background: var(--status-food); }
        .st-water { background: var(--status-water); }

        /* --- Quiz --- */
        .quiz-panel {
            background: white;
            padding: 25px 20px; border-radius: 16px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); text-align: center;
            max-width: 600px; margin: 0 auto;
            border: 1px solid #eee;
        }
        .q-media-box {
            height: 280px;
            background: #fafafa; border: 2px dashed #a5d6a7;
            border-radius: 12px; margin: 20px 0; display: flex;
            align-items: center; justify-content: center; position: relative;
            overflow: hidden;
        }
        .full-img { max-width: 100%; max-height: 100%; object-fit: contain; display: none; }
        
        .opt-btn {
            width: 100%;
            padding: 14px; margin-bottom: 10px; background: white;
            border: 2px solid #c8e6c9; border-radius: 10px; font-size: 0.95rem;
            cursor: pointer; font-weight: bold; color: #2e7d32;
            touch-action: manipulation;
        }
        .opt-btn:active { background: #e8f5e9; }
        .opt-btn.correct { background: #c8e6c9; border-color: #66bb6a; color: #1b5e20; }
        .opt-btn.wrong { background: #ffcdd2; border-color: #ef5350; color: #b71c1c; }

        /* --- Modal --- */
        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 2000;
            display: none; justify-content: center; align-items: center; padding: 15px;
            backdrop-filter: blur(5px);
            touch-action: none;
        }
        .modal-box {
            background: white;
            width: 100%; max-width: 500px;
            border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;
            max-height: 85vh;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popUp { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .img-area { 
            height: 40vh;
            background: #000; display: flex; align-items: center; justify-content: center; 
        }
        .info-area { padding: 20px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .reveal-box {
            background: #e8f5e9;
            border: 1px solid #c8e6c9; border-radius: 12px;
            padding: 15px; text-align: left; margin-top: 15px; display: none;
        }

        @media (min-width: 768px) {
            .container { padding: 30px; }
            .plant-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); }
            .nav { justify-content: center; top: 85px; }
            .card-scene { height: 550px; }
            h1 { font-size: 2rem; }
            .img-area { height: 300px; }
        }

    </style>
</head>
<body>

<header>
    <h1>ğŸŒ¿ å°ç£å¸¸è¦‹æ¤ç‰©åœ–é‘‘</h1>
    <div class="subtitle">æ”¶éŒ„ 150+ ç¨®ç”Ÿæ´»å¸¸è¦‹èŠ±è‰æ¨¹æœ¨</div>
</header>

<div class="nav">
    <button class="nav-btn active" onclick="setTab('daily', this)">ğŸ”® æ¯æ—¥ä¸€æ¤</button>
    <button class="nav-btn" onclick="setTab('guide', this)">ğŸ“– æ¤ç‰©åœ–é‘‘</button>
    <button class="nav-btn" onclick="setTab('quiz', this)">ğŸŒ² ç¶ æ‰‹æŒ‡æ¸¬é©—</button>
</div>

<div class="container">

    <div id="sec-daily" class="section active">
        <div class="daily-container">
            <h2 style="color:var(--primary); margin: 0 0 5px 0; font-size: 1.3rem;">ğŸ“… ä»Šå¤©çš„æ¤ç‰©å¤¥ä¼´</h2>
            <p style="color:#666; font-size:0.85rem; margin-top: 0;">æ¯å¤©èªè­˜ä¸€ä½è‡ªç„¶ç•Œçš„æ–°æœ‹å‹</p>
            
            <div class="card-scene">
                <div class="card-inner" id="daily-card-inner">
                    <div class="card-face card-front" onclick="flipDailyCard()">
                        <div style="font-size:4rem; margin-bottom:10px; text-shadow: 0 4px 10px rgba(0,0,0,0.3);">ğŸŒ±</div>
                        <h2 style="letter-spacing: 2px; font-size: 1.5rem;">DAILY PLANT</h2>
                        <div class="daily-date" id="daily-date-display">...</div>
                        <p style="opacity: 0.9; font-size: 0.9rem;">é»æ“Šç¿»é–‹</p>
                    </div>
                    
                    <div class="card-face card-back">
                        <div class="daily-img-wrapper" onclick="openDailyZoom()">
                            <img id="daily-img" class="daily-img" src="" alt="Plant">
                            <div class="loader" id="daily-loader" style="position:absolute; top:45%; left:45%;"></div>
                            <div class="zoom-hint">ğŸ” é»åœ–æ”¾å¤§</div>
                        </div>
                        <div class="daily-info-box">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <h2 id="daily-name" style="margin:0; color:var(--primary); font-size: 1.4rem;">è¼‰å…¥ä¸­...</h2>
                                <span id="daily-status" class="status-badge"></span>
                            </div>
                            <p id="daily-eng" style="color:#78909c; font-style:italic; font-size:0.85rem; margin-top:2px;"></p>
                            <hr style="border:0; border-top:1px solid #eee; margin:10px 0;">
                            <p id="daily-desc" style="line-height:1.6; color:#546e7a; font-size:0.9rem;">
                                é€£ç·šä¸­...
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="sec-guide" class="section">
        <div class="tools-bar">
            <input type="text" id="search-input" class="search-box" placeholder="æœå°‹ (å¦‚ï¼šæ¦•æ¨¹, ç™¾åˆ)..." onkeyup="renderGuide()">
            <div class="filter-scroll">
                <div class="filter-tag active" onclick="setFilter('all', this)">å…¨éƒ¨</div>
                <div class="filter-tag" onclick="setFilter('æ¨¹æœ¨', this)">æ¨¹æœ¨/è¡Œé“æ¨¹</div>
                <div class="filter-tag" onclick="setFilter('èŠ±å‰', this)">èŠ±å‰/çŒæœ¨</div>
                <div class="filter-tag" onclick="setFilter('é‡è‰', this)">é‡èŠ±/é‡è‰</div>
                <div class="filter-tag" onclick="setFilter('è•¨é¡', this)">è•¨é¡</div>
                <div class="filter-tag" onclick="setFilter('é£Ÿç”¨', this)">é£Ÿç”¨/æœæ¨¹</div>
                <div class="filter-tag" onclick="setFilter('ç‰¹æœ‰ç¨®', this)">ç‰¹æœ‰ç¨®</div>
                <div class="filter-tag" onclick="setFilter('æœ‰æ¯’', this)">æœ‰æ¯’</div>
            </div>
            <div style="text-align:right; font-size:0.75rem; color:#888; margin-top:8px;">
                è³‡æ–™åº«ï¼š<span id="db-count">0</span> ç¨®
            </div>
        </div>
        <div id="guide-grid" class="plant-grid"></div>
    </div>

    <div id="sec-quiz" class="section">
        <div id="quiz-menu" class="quiz-panel">
            <h2 style="color:var(--primary); font-size: 1.4rem;">ğŸŒ» æ¤ç‰©è¾¨è­˜å¤§æŒ‘æˆ°</h2>
            <p style="font-size: 0.95rem; color: #555;">ç¾åœ¨è³‡æ–™åº«æ“´å¢äº†ï¼Œè€ƒé©—è®Šé›£å›‰ï¼</p>
            <br>
            <div style="font-size:3.5rem; margin-bottom:15px;">ğŸŒ³</div>
            <button class="nav-btn" style="background:var(--primary); color:white; width:100%; padding:15px; font-size:1.1rem;" onclick="startQuiz()">
                é–‹å§‹æŒ‘æˆ°
            </button>
        </div>

        <div id="quiz-play" class="quiz-panel" style="display:none;">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-weight:bold; color:#78909c; font-size: 0.9rem;">
                <span id="q-progress">1 / 10</span>
                <span>åˆ†æ•¸: <span id="q-score">0</span></span>
            </div>
            
            <h3 style="margin:0; color:#37474f; font-size: 1.2rem;">é€™æ˜¯ä»€éº¼æ¤ç‰©ï¼Ÿ</h3>
            <div id="skip-indicator" class="skip-msg">âš ï¸ åœ–ç‰‡è®€å–å¤±æ•—ï¼Œè‡ªå‹•è£œé¡Œ</div>

            <div class="q-media-box">
                <div class="loader" id="v-loader"></div>
                <img id="q-img" class="full-img">
            </div>

            <div id="opt-container"></div>
            <div id="feedback" style="height:25px; font-weight:bold; margin-top:5px; font-size: 1rem;"></div>

            <div id="reveal-card" class="reveal-box">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <strong id="rev-name" style="font-size:1.2rem; color:var(--primary);"></strong>
                    <span id="rev-status" class="status-badge"></span>
                </div>
                <p id="rev-desc" style="font-size:0.9rem; margin-top:8px; color:#455a64; line-height:1.5;"></p>
                <a id="rev-link" href="#" target="_blank" style="font-size:0.85rem; display:block; margin-top:10px; color:var(--secondary); font-weight:bold;">ğŸ“– æŸ¥çœ‹ç™¾ç§‘</a>
            </div>

            <button id="next-btn" class="nav-btn" style="width:100%; background:var(--primary); color:white; margin-top:15px; display:none;" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â†’</button>
            <button onclick="quitQuiz()" style="background:none; border:none; margin-top:15px; color:#90a4ae; text-decoration:underline; cursor:pointer; font-size: 0.9rem;">é€€å‡º</button>
        </div>

        <div id="quiz-result" class="quiz-panel" style="display:none;">
            <h2>ğŸ† æŒ‘æˆ°å®Œæˆ</h2>
            <p>æœ¬æ¬¡å¾—åˆ†</p>
            <h1 id="final-score" style="font-size:3.5rem; margin:10px 0; color:var(--primary);">0</h1>
            <div id="final-rank" style="font-size:1rem; background:var(--accent); color:#37474f; padding:6px 20px; border-radius:20px; display:inline-block; font-weight:bold;"></div>
            <br><br>
            <button class="nav-btn" onclick="quitQuiz()">è¿”å›ä¸»é¸å–®</button>
        </div>
    </div>

</div>

<div id="modal" class="modal" onclick="closeModal(event)">
    <div class="modal-box">
        <div class="img-area">
            <div class="loader" id="m-loader"></div>
            <img id="m-img" class="full-img">
            <div id="m-err" style="display:none; color:white;">ç„¡åœ–ç‰‡è³‡æ–™</div>
        </div>
        <div class="info-area">
            <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                <h2 id="m-name" style="margin:0; color:var(--primary); font-size: 1.5rem;"></h2>
                <span id="m-status" class="status-badge" style="margin:0;"></span>
            </div>
            <div id="m-latin" style="color:#78909c; font-style:italic; margin-bottom:10px; margin-top:2px; font-size: 0.9rem;"></div>
            <p id="m-desc" style="line-height:1.6; color:#455a64; font-size: 0.95rem;">è®€å–ä¸­...</p>
            
            <a id="m-wiki" href="#" target="_blank" style="display:block; text-align:center; margin-top:20px; padding:12px; background:#e8f5e9; color:var(--primary); text-decoration:none; border-radius:8px; font-weight:bold;">å‰å¾€ç¶­åŸºç™¾ç§‘é–±è®€æ›´å¤š</a>
        </div>
        <button onclick="closeModal(null)" style="width:100%; padding:15px; border:none; background:#eceff1; color:#78909c; cursor:pointer; font-size:1rem; border-top:1px solid #ddd; font-weight: bold;">é—œé–‰è¦–çª—</button>
    </div>
</div>

<script>
    // --- æ“´å……ç‰ˆå°ç£å¸¸è¦‹æ¤ç‰©è³‡æ–™åº« (ç´„150ç¨®) ---
    // cat: æ¨¹æœ¨, å¸¸è¦‹(èŠ±/çŒæœ¨), è•¨é¡, é‡è‰, æœ‰æ¯’, é£Ÿç”¨, æ°´ç”Ÿ
    const plants = [
        // --- 1. å¸¸è¦‹è¡Œé“æ¨¹èˆ‡æœ¨æœ¬ ---
        { name: "æ¦•æ¨¹", eng: "Ficus microcarpa", cat: "æ¨¹æœ¨", status: "åŸç”Ÿ/æ°£æ ¹" },
        { name: "æ¨Ÿæ¨¹", eng: "Cinnamomum camphora", cat: "æ¨¹æœ¨", status: "åŸç”Ÿ/é¦™æ°£" },
        { name: "èŒ„è‹³", eng: "Bischofia javanica", cat: "æ¨¹æœ¨", status: "åŸç”Ÿ/è€æ¨¹" },
        { name: "æ¥“é¦™", eng: "Liquidambar formosana", cat: "æ¨¹æœ¨", status: "åŸç”Ÿ/è®Šè‰²" },
        { name: "å¤§è‘‰æ¥ ", eng: "Machilus japonica", cat: "æ¨¹æœ¨", status: "ç‰¹æœ‰ç¨®/å¸¸è¦‹" },
        { name: "å°ç£æ¬’æ¨¹", eng: "Koelreuteria elegans", cat: "æ¨¹æœ¨", status: "ç‰¹æœ‰ç¨®/å››è‰²æ¨¹" },
        { name: "è‹¦æ¥", eng: "Melia azedarach", cat: "æ¨¹æœ¨", status: "åŸç”Ÿ/ç´«èŠ±" },
        { name: "ç›¸æ€æ¨¹", eng: "Acacia confusa", cat: "æ¨¹æœ¨", status: "åŸç”Ÿ/é€ æ—" },
        { name: "æœ¨æ£‰", eng: "Bombax ceiba", cat: "æ¨¹æœ¨", status: "å¸¸è¦‹/æ£‰çµ®" },
        { name: "é³³å‡°æœ¨", eng: "Delonix regia", cat: "æ¨¹æœ¨", status: "å¤–ä¾†ç¨®/ç´…èŠ±" },
        { name: "é˜¿å‹ƒå‹’", eng: "Cassia fistula", cat: "æ¨¹æœ¨", status: "å¤–ä¾†ç¨®/é»ƒé‡‘é›¨" },
        { name: "é»‘æ¿æ¨¹", eng: "Alstonia scholaris", cat: "æ¨¹æœ¨", status: "å¸¸è¦‹/ç•°å‘³" },
        { name: "å¤§ç‹æ¤°å­", eng: "Roystonea regia", cat: "æ¨¹æœ¨", status: "å¤–ä¾†ç¨®/é«˜å¤§" },
        { name: "å°è‘‰æ¬–ä»", eng: "Terminalia mantaly", cat: "æ¨¹æœ¨", status: "å¤–ä¾†ç¨®/å±¤æ¬¡" },
        { name: "å¤§è‘‰æ¬–ä»", eng: "Terminalia catappa", cat: "æ¨¹æœ¨", status: "åŸç”Ÿ/è½è‘‰" },
        { name: "ç¾Šè¹„ç”²", eng: "Bauhinia variegata", cat: "æ¨¹æœ¨", status: "å¸¸è¦‹/ç²‰èŠ±" },
        { name: "è‰·ç´«èŠ", eng: "Bauhinia Ã— blakeana", cat: "æ¨¹æœ¨", status: "é›œäº¤/åœ‹èŠ±" },
        { name: "é»ƒèŠ±é¢¨éˆ´æœ¨", eng: "Handroanthus chrysotrichus", cat: "æ¨¹æœ¨", status: "å¤–ä¾†ç¨®/é»ƒèŠ±" },
        { name: "å±±æ«»èŠ±", eng: "Prunus campanulata", cat: "æ¨¹æœ¨", status: "ç‰¹æœ‰ç¨®/æ¡ƒç´…" },
        { name: "å‰é‡æ«»", eng: "Prunus Ã— yedoensis", cat: "æ¨¹æœ¨", status: "å¤–ä¾†ç¨®/æ·¡ç²‰" },
        { name: "æ¢…èŠ±", eng: "Prunus mume", cat: "æ¨¹æœ¨", status: "å¤–ä¾†ç¨®/åœ‹èŠ±" },
        { name: "æµè˜‡æ¨¹", eng: "Chionanthus retusus", cat: "æ¨¹æœ¨", status: "åŸç”Ÿ/å››æœˆé›ª", wikiTerm: "æµè˜‡æ¨¹" },
        { name: "ç¾…æ¼¢æ¾", eng: "Podocarpus macrophyllus", cat: "æ¨¹æœ¨", status: "å¸¸è¦‹/åœ’è—" },
        { name: "è½ç¾½æ¾", eng: "Taxodium distichum", cat: "æ¨¹æœ¨", status: "å¤–ä¾†ç¨®/è®Šè‰²" },
        { name: "è‚¯æ°å—æ´‹æ‰", eng: "Araucaria cunninghamii", cat: "æ¨¹æœ¨", status: "å¤–ä¾†ç¨®/é«˜è³" },
        { name: "ç™½åƒå±¤", eng: "Melaleuca cajuputi", cat: "æ¨¹æœ¨", status: "å¤–ä¾†ç¨®/è„«çš®" },
        { name: "æ°´é»ƒçš®", eng: "Millettia pinnata", cat: "æ¨¹æœ¨", status: "åŸç”Ÿ/æ¿±æµ·" },
        { name: "è¡€æ¡", eng: "Macaranga tanarius", cat: "æ¨¹æœ¨", status: "åŸç”Ÿ/ç›¾ç‹€è‘‰" },
        { name: "æ§‹æ¨¹", eng: "Broussonetia papyrifera", cat: "æ¨¹æœ¨", status: "åŸç”Ÿ/é¹¿ä»”æ¨¹" },
        { name: "éºµåŒ…æ¨¹", eng: "Artocarpus altilis", cat: "æ¨¹æœ¨", status: "å¤–ä¾†ç¨®/å¤§è‘‰" },
        { name: "ç›¾æŸ±æœ¨", eng: "Peltophorum pterocarpum", cat: "æ¨¹æœ¨", status: "å¤–ä¾†ç¨®/é»ƒèŠ±" },
        { name: "ç«ç„°æœ¨", eng: "Spathodea campanulata", cat: "æ¨¹æœ¨", status: "å¤–ä¾†ç¨®/ç´…èŠ±" },
        { name: "ç¦æœ¨", eng: "Garcinia subelliptica", cat: "æ¨¹æœ¨", status: "å¸¸è¦‹/é˜²é¢¨" },
        { name: "å°ç£è‚–æ¥ ", eng: "Calocedrus formosana", cat: "æ¨¹æœ¨", status: "ç‰¹æœ‰ç¨®/çè²´" },
        { name: "ç´…æªœ", eng: "Chamaecyparis formosensis", cat: "æ¨¹æœ¨", status: "ç‰¹æœ‰ç¨®/ç¥æœ¨" },
        { name: "ç‰å±±åœ“æŸ", eng: "Juniperus morrisonicola", cat: "æ¨¹æœ¨", status: "ç‰¹æœ‰ç¨®/é«˜å±±" },

        // --- 2. çŒæœ¨èˆ‡åœ’è—èŠ±å‰ ---
        { name: "æœ±æ§¿", eng: "Hibiscus rosa-sinensis", cat: "èŠ±å‰", status: "å¸¸è¦‹/åœç±¬" },
        { name: "æœéµ‘èŠ±", eng: "Rhododendron", cat: "èŠ±å‰", status: "å¸¸è¦‹/å°åŒ—å¸‚èŠ±", wikiTerm: "æœéµ‘èŠ±" },
        { name: "ä¹é‡è‘›", eng: "Bougainvillea spectabilis", cat: "èŠ±å‰", status: "å¸¸è¦‹/è—¤æœ¬" },
        { name: "æ¡‚èŠ±", eng: "Osmanthus fragrans", cat: "èŠ±å‰", status: "é¦™æ°£/é£Ÿç”¨" },
        { name: "ä¸ƒé‡Œé¦™", eng: "Murraya paniculata", cat: "èŠ±å‰", status: "åŸç”Ÿ/é¦™æ°£", wikiTerm: "æœˆæ©˜" },
        { name: "æ—¥æ—¥æ˜¥", eng: "Catharanthus roseus", cat: "èŠ±å‰", status: "å¸¸è¦‹/æœ‰æ¯’", wikiTerm: "é•·æ˜¥èŠ±" },
        { name: "é›è›‹èŠ±", eng: "Plumeria rubra", cat: "èŠ±å‰", status: "é¦™æ°£/è½è‘‰", wikiTerm: "ç·¬æ¢”" },
        { name: "é¦¬çº“ä¸¹", eng: "Lantana camara", cat: "èŠ±å‰", status: "å¤–ä¾†ç¨®/æœ‰æ¯’" },
        { name: "ä»™ä¸¹èŠ±", eng: "Ixora chinensis", cat: "èŠ±å‰", status: "å¸¸è¦‹/èœœæº" },
        { name: "é‡‘éœ²èŠ±", eng: "Duranta erecta", cat: "èŠ±å‰", status: "å¸¸è¦‹/ç´«è‰²" },
        { name: "æ¨¹è˜­", eng: "Aglaia odorata", cat: "èŠ±å‰", status: "é¦™æ°£/å°é»ƒèŠ±" },
        { name: "å«ç¬‘èŠ±", eng: "Michelia figo", cat: "èŠ±å‰", status: "é¦™æ°£" },
        { name: "èŒ‰è‰èŠ±", eng: "Jasminum sambac", cat: "èŠ±å‰", status: "é¦™æ°£/èŒ¶" },
        { name: "æ¢”å­èŠ±", eng: "Gardenia jasminoides", cat: "èŠ±å‰", status: "é¦™æ°£/ç™½èŠ±" },
        { name: "èŒ¶èŠ±", eng: "Camellia japonica", cat: "èŠ±å‰", status: "è§€è³/å†¬å­£" },
        { name: "ç«ç‘°", eng: "Rosa", cat: "èŠ±å‰", status: "è§€è³/åˆº" },
        { name: "ç¹¡çƒèŠ±", eng: "Hydrangea macrophylla", cat: "èŠ±å‰", status: "è§€è³/é™½æ˜å±±" },
        { name: "è–èª•ç´…", eng: "Euphorbia pulcherrima", cat: "èŠ±å‰", status: "è§€è³/å†¬å­£" },
        { name: "è®Šè‘‰æœ¨", eng: "Codiaeum variegatum", cat: "èŠ±å‰", status: "è§€è³/å½©è‰²" },
        { name: "ç‚®ä»—èŠ±", eng: "Pyrostegia venusta", cat: "èŠ±å‰", status: "è—¤æœ¬/æ©˜ç´…" },
        { name: "è’œé¦™è—¤", eng: "Mansoa alliacea", cat: "èŠ±å‰", status: "è—¤æœ¬/ç´«èŠ±" },
        { name: "è»Ÿæé»ƒèŸ¬", eng: "Allamanda cathartica", cat: "èŠ±å‰", status: "è—¤æœ¬/æœ‰æ¯’" },
        { name: "å­¤æŒºèŠ±", eng: "Hippeastrum", cat: "èŠ±å‰", status: "çƒæ ¹/å¤§èŠ±" },
        { name: "å¤©å ‚é³¥", eng: "Strelitzia reginae", cat: "èŠ±å‰", status: "è§€è³/åˆ‡èŠ±", wikiTerm: "é¶´æœ›è˜­" },
        { name: "ç«é¶´èŠ±", eng: "Anthurium andraeanum", cat: "èŠ±å‰", status: "è§€è³/å®¤å…§" },

        // --- 3. é‡èŠ±ã€é‡è‰èˆ‡åœ°è¢« ---
        { name: "å¤§èŠ±å’¸è±è‰", eng: "Bidens pilosa", cat: "é‡è‰", status: "å¤–ä¾†ç¨®/å¼·å‹¢" },
        { name: "é…¢æ¼¿è‰", eng: "Oxalis corniculata", cat: "é‡è‰", status: "å¸¸è¦‹/é…¸" },
        { name: "ç´«èŠ±é…¢æ¼¿è‰", eng: "Oxalis debilis", cat: "é‡è‰", status: "å¤–ä¾†ç¨®/å¡Šæ ¹" },
        { name: "å«ç¾è‰", eng: "Mimosa pudica", cat: "é‡è‰", status: "å¸¸è¦‹/è¶£å‘³" },
        { name: "æ˜­å’Œè‰", eng: "Crassocephalum crepidioides", cat: "é‡è‰", status: "é‡èœ/é£›æ©Ÿè‰" },
        { name: "ç´«èŠ±éœé¦™è–Š", eng: "Ageratum houstonianum", cat: "é‡è‰", status: "å¸¸è¦‹/ç´«è‰²" },
        { name: "è»Šå‰è‰", eng: "Plantago asiatica", cat: "é‡è‰", status: "è—¥ç”¨/è€è¸©" },
        { name: "è’²å…¬è‹±", eng: "Taraxacum", cat: "é‡è‰", status: "å¸¸è¦‹/ç¨®å­" },
        { name: "é¾è‘µ", eng: "Solanum nigrum", cat: "é‡è‰", status: "é‡èœ/é»‘ç”œèœ" },
        { name: "è›‡è“", eng: "Duchesnea indica", cat: "é‡è‰", status: "ä¼¼è‰è“/é‡å¤–" },
        { name: "é›·å…¬æ ¹", eng: "Centella asiatica", cat: "é‡è‰", status: "è—¥ç”¨/ç©é›ªè‰" },
        { name: "äº”ç¯€èŠ’", eng: "Miscanthus floridulus", cat: "é‡è‰", status: "åŸç”Ÿ/ç¦¾è‰" },
        { name: "å°èŠ±è”“æ¾¤è˜­", eng: "Mikania micrantha", cat: "é‡è‰", status: "å¤–ä¾†ç¨®/ç¶ ç™Œ" },
        { name: "å°ç£ç™¾åˆ", eng: "Lilium formosanum", cat: "é‡è‰", status: "ç‰¹æœ‰ç¨®/ç´…æ¢ç´‹" },
        { name: "éµç‚®ç™¾åˆ", eng: "Lilium longiflorum", cat: "é‡è‰", status: "åŸç”Ÿ/å…¨ç™½" },
        { name: "æœˆæ¡ƒ", eng: "Alpinia zerumbet", cat: "é‡è‰", status: "åŸç”Ÿ/æ°‘ä¿—" },
        { name: "é‡è–‘èŠ±", eng: "Hedychium coronarium", cat: "é‡è‰", status: "æ°´é‚Š/é¦™æ°£" },
        { name: "å°„å¹²", eng: "Iris domestica", cat: "é‡è‰", status: "æ©˜èŠ±/é»‘é»" },
        { name: "èŸ›èœèŠ", eng: "Sphagneticola calendulacea", cat: "é‡è‰", status: "æ¿±æµ·/é»ƒèŠ±" },

        // --- 4. è•¨é¡ ---
        { name: "ç­†ç­’æ¨¹", eng: "Sphaeropteris lepifera", cat: "è•¨é¡", status: "åŸç”Ÿ/å¤§å‹" },
        { name: "å°ç£æ¡«æ¬", eng: "Alsophila spinulosa", cat: "è•¨é¡", status: "åŸç”Ÿ/è£™å­" },
        { name: "é³¥å·¢è•¨", eng: "Asplenium nidus", cat: "è•¨é¡", status: "é™„ç”Ÿ/å±±è˜‡", wikiTerm: "å·¢è•¨" },
        { name: "å´–å§œè•¨", eng: "Pseudodrynaria coronans", cat: "è•¨é¡", status: "é™„ç”Ÿ/ç’°ç‹€" },
        { name: "éµç·šè•¨", eng: "Adiantum capillus-veneris", cat: "è•¨é¡", status: "è§€è³/é»‘è‰²è–" },
        { name: "é³³å°¾è•¨", eng: "Pteris", cat: "è•¨é¡", status: "å¸¸è¦‹/ç‰†è§’" },
        { name: "è…è•¨", eng: "Nephrolepis cordifolia", cat: "è•¨é¡", status: "å¸¸è¦‹/çƒè–" },
        { name: "é¹¿è§’è•¨", eng: "Platycerium", cat: "è•¨é¡", status: "è§€è³/é™„ç”Ÿ" },
        { name: "ä¼çŸ³è•¨", eng: "Lemmaphyllum microphyllum", cat: "è•¨é¡", status: "é™„ç”Ÿ/åœ“è‘‰" },
        { name: "æµ·é‡‘æ²™", eng: "Lygodium japonicum", cat: "è•¨é¡", status: "æ”€ç·£/æ¥µé•·" },
        { name: "è§€éŸ³åº§è“®", eng: "Angiopteris lygodiifolia", cat: "è•¨é¡", status: "å¤§å‹/åŸºéƒ¨" },
        { name: "æ±æ–¹ç‹—è„Šè•¨", eng: "Woodwardia orientalis", cat: "è•¨é¡", status: "å¸¸è¦‹/ä¸å®šèŠ½" },

        // --- 5. é£Ÿç”¨èˆ‡æœæ¨¹ ---
        { name: "æ°´ç¨»", eng: "Oryza sativa", cat: "é£Ÿç”¨", status: "ä½œç‰©/ç³§é£Ÿ", wikiTerm: "ç¨»" },
        { name: "èŒ¶æ¨¹", eng: "Camellia sinensis", cat: "é£Ÿç”¨", status: "ç¶“æ¿Ÿ/é£²æ–™" },
        { name: "æª³æ¦”", eng: "Areca catechu", cat: "é£Ÿç”¨", status: "æ·ºæ ¹/çˆ­è­°" },
        { name: "é¦™è•‰", eng: "Musa acuminata", cat: "é£Ÿç”¨", status: "æ°´æœ/å·¨å¤§è‰æœ¬" },
        { name: "èŠ’æœ", eng: "Mangifera indica", cat: "é£Ÿç”¨", status: "æ°´æœ/è¡Œé“æ¨¹" },
        { name: "é¾çœ¼", eng: "Dimocarpus longan", cat: "é£Ÿç”¨", status: "æ°´æœ/å¸¸è¦‹" },
        { name: "è”æ", eng: "Litchi chinensis", cat: "é£Ÿç”¨", status: "æ°´æœ/å¤å­£" },
        { name: "æ¥Šæ¡ƒ", eng: "Averrhoa carambola", cat: "é£Ÿç”¨", status: "æ°´æœ/æ˜Ÿå½¢" },
        { name: "è“®éœ§", eng: "Syzygium samarangense", cat: "é£Ÿç”¨", status: "æ°´æœ/å±æ±" },
        { name: "ç•ªçŸ³æ¦´", eng: "Psidium guajava", cat: "é£Ÿç”¨", status: "æ°´æœ/èŠ­æ¨‚" },
        { name: "æœ¨ç“œ", eng: "Carica papaya", cat: "é£Ÿç”¨", status: "æ°´æœ/å¸¸è¦‹" },
        { name: "æŸšå­", eng: "Citrus maxima", cat: "é£Ÿç”¨", status: "æ°´æœ/ä¸­ç§‹" },
        { name: "æ¡‘æ¤¹", eng: "Morus alba", cat: "é£Ÿç”¨", status: "é¤Šè ¶/æœå¯¦", wikiTerm: "æ¡‘" },
        { name: "åœ°ç“œ", eng: "Ipomoea batatas", cat: "é£Ÿç”¨", status: "å¡Šæ ¹/ç•ªè–¯", wikiTerm: "ç•ªè–¯" },
        { name: "èŠ‹é ­", eng: "Colocasia esculenta", cat: "é£Ÿç”¨", status: "å¡Šè–/æ°´ç”Ÿ", wikiTerm: "èŠ‹" },

        // --- 6. æ°´ç”Ÿèˆ‡æ¿•åœ° ---
        { name: "è“®èŠ±", eng: "Nelumbo nucifera", cat: "æ°´ç”Ÿ", status: "ç¶“æ¿Ÿ/è§€è³", wikiTerm: "è“®" },
        { name: "ç¡è“®", eng: "Nymphaea tetragona", cat: "æ°´ç”Ÿ", status: "è§€è³/è²¼æ°´" },
        { name: "å°ç£èè“¬è‰", eng: "Nuphar shimadae", cat: "æ°´ç”Ÿ", status: "ç‰¹æœ‰ç¨®/æ°´è“®èŠ±" },
        { name: "å¸ƒè¢‹è“®", eng: "Pontederia crassipes", cat: "æ°´ç”Ÿ", status: "å¤–ä¾†ç¨®/å¼·å‹¢" },
        { name: "å¤§è", eng: "Pistia stratiotes", cat: "æ°´ç”Ÿ", status: "å¤–ä¾†ç¨®/æ°´èŠ™è“‰" },
        { name: "æ°´ç­†ä»”", eng: "Kandelia obovata", cat: "æ°´ç”Ÿ", status: "ç´…æ¨¹æ—/èƒç”Ÿ" },

        // --- 7. æœ‰æ¯’èˆ‡å…¶ä»– ---
        { name: "å§‘å©†èŠ‹", eng: "Alocasia odora", cat: "æœ‰æ¯’", status: "æœ‰æ¯’/ä¼¼èŠ‹é ­" },
        { name: "å¤¾ç«¹æ¡ƒ", eng: "Nerium oleander", cat: "æœ‰æ¯’", status: "åŠ‡æ¯’/è§€è³" },
        { name: "æµ·æª¬æœ", eng: "Cerbera manghas", cat: "æœ‰æ¯’", status: "æœ‰æ¯’/æ¿±æµ·" },
        { name: "å’¬äººè²“", eng: "Urtica thunbergiana", cat: "æœ‰æ¯’", status: "æœ‰æ¯’/åˆºæ¯›" },
        { name: "éŠ€è† èŠ", eng: "Parthenium hysterophorus", cat: "æœ‰æ¯’", status: "å¤–ä¾†ç¨®/éæ•" },
        { name: "å¤§èŠ±æ›¼é™€ç¾…", eng: "Brugmansia suaveolens", cat: "æœ‰æ¯’", status: "æœ‰æ¯’/ç™½èŠ±" },
        { name: "ç›¸æ€è±†", eng: "Abrus precatorius", cat: "æœ‰æ¯’", status: "åŠ‡æ¯’/ç´…è±†", wikiTerm: "é›æ¯ç " },
        { name: "é»ƒé‡‘è‘›", eng: "Epipremnum aureum", cat: "æœ‰æ¯’", status: "å®¤å…§/æ±æ¶²æ¯’" },
        { name: "åˆæœèŠ‹", eng: "Syngonium podophyllum", cat: "æœ‰æ¯’", status: "åœ’è—/å¸¸è¦‹" },
        { name: "é»›ç²‰è‘‰", eng: "Dieffenbachia", cat: "æœ‰æ¯’", status: "åœ’è—/å¸¸è¦‹", wikiTerm: "èŠ±è‘‰è¬å¹´é’" }
    ];

    // --- Helper Functions ---
    function getStatusClass(status) {
        if (status.includes("ç‰¹æœ‰ç¨®")) return "st-endemic";
        if (status.includes("æœ‰æ¯’") || status.includes("åŠ‡æ¯’") || status.includes("éæ•")) return "st-poison";
        if (status.includes("é£Ÿç”¨") || status.includes("æ°´æœ") || status.includes("ä½œç‰©")) return "st-food";
        if (status.includes("æ°´ç”Ÿ") || status.includes("æ°´é‚Š")) return "st-water";
        if (status.includes("æ¨¹æœ¨") || status.includes("æœ¨æœ¬")) return "st-tree";
        if (status.includes("å¤–ä¾†ç¨®")) return "st-alien";
        return "st-common";
    }

    const getWikiData = async (plantName, wikiTerm = null) => {
        try {
            const term = wikiTerm || plantName;
            // å˜—è©¦ç²å–ä¸­æ–‡ç¶­åŸºç™¾ç§‘è³‡æ–™
            const res = await fetch(`https://zh.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(term)}`);
            if(!res.ok) throw new Error();
            return await res.json();
        } catch(e) { return null; }
    };

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        renderGuide();
        document.getElementById('db-count').innerText = plants.length;
        
        // æ¯æ—¥ä¸€æ¤æ—¥æœŸ
        const today = new Date();
        const dateStr = `${today.getFullYear()} / ${today.getMonth()+1} / ${today.getDate()}`;
        document.getElementById('daily-date-display').innerText = dateStr;
    });

    // --- Tab Switching ---
    function setTab(tab, btn) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        
        document.getElementById(`sec-${tab}`).classList.add('active');
        btn.classList.add('active');
        window.scrollTo(0, 0);

        if (tab !== 'quiz') quitQuiz();
    }

    // --- Guide ---
    let currentFilter = 'all';
    function renderGuide() {
        const grid = document.getElementById('guide-grid');
        grid.innerHTML = '';
        const term = document.getElementById('search-input').value.toLowerCase();
        
        const list = plants.filter(p => {
            let matchCat = false;
            // ç¯©é¸é‚è¼¯å„ªåŒ–
            if(currentFilter === 'all') matchCat = true;
            else if(currentFilter === 'æ¨¹æœ¨') matchCat = p.cat === 'æ¨¹æœ¨';
            else if(currentFilter === 'èŠ±å‰') matchCat = p.cat === 'èŠ±å‰' || p.cat === 'å¸¸è¦‹';
            else if(currentFilter === 'é‡è‰') matchCat = p.cat === 'é‡è‰';
            else if(currentFilter === 'è•¨é¡') matchCat = p.cat === 'è•¨é¡';
            else if(currentFilter === 'é£Ÿç”¨') matchCat = p.cat === 'é£Ÿç”¨' || p.status.includes('é£Ÿç”¨');
            else if(currentFilter === 'ç‰¹æœ‰ç¨®') matchCat = p.status.includes('ç‰¹æœ‰ç¨®');
            else if(currentFilter === 'æœ‰æ¯’') matchCat = p.cat === 'æœ‰æ¯’' || p.status.includes('æœ‰æ¯’');
            else matchCat = p.cat.includes(currentFilter) || p.status.includes(currentFilter);
            
            const matchSearch = p.name.includes(term) || p.eng.toLowerCase().includes(term);
            return matchCat && matchSearch;
        });

        list.forEach(p => {
            const el = document.createElement('div');
            el.className = 'plant-card';
            el.innerHTML = `
                <div class="p-name">${p.name}</div>
                <div class="p-cat">${p.eng.split(' ')[0]}...</div>
                <div class="status-badge ${getStatusClass(p.status)}">${p.status}</div>
            `;
            el.onclick = () => openModal(p);
            grid.appendChild(el);
        });
    }

    function setFilter(cat, btn) {
        currentFilter = cat;
        document.querySelectorAll('.filter-tag').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        renderGuide();
    }

    // --- Daily Card Logic ---
    let isDailyFlipped = false;
    let currentDailyPlant = null;

    function flipDailyCard() {
        if (isDailyFlipped) return;
        
        const cardInner = document.getElementById('daily-card-inner');
        cardInner.classList.add('is-flipped');
        isDailyFlipped = true;
        
        loadDailyPlantData();
    }
    
    function openDailyZoom() {
        if (!currentDailyPlant) return;
        openModal(currentDailyPlant);
    }

    async function loadDailyPlantData() {
        const todayStr = new Date().toDateString();
        let hash = 0;
        for (let i = 0; i < todayStr.length; i++) hash = todayStr.charCodeAt(i) + ((hash << 5) - hash);
        const seed = Math.abs(hash); 
        const index = seed % plants.length;
        const plant = plants[index];
        currentDailyPlant = plant;

        document.getElementById('daily-name').innerText = plant.name;
        document.getElementById('daily-eng').innerText = plant.eng;
        
        const badge = document.getElementById('daily-status');
        badge.innerText = plant.status;
        badge.className = `status-badge ${getStatusClass(plant.status)}`;

        const data = await getWikiData(plant.name, plant.wikiTerm);
        const img = document.getElementById('daily-img');
        const loader = document.getElementById('daily-loader');
        const desc = document.getElementById('daily-desc');

        if(data) {
            desc.innerText = data.extract ? (data.extract.substring(0, 100) + "...") : "æš«ç„¡è©³ç´°ä»‹ç´¹ã€‚";
            const src = data.originalimage ? data.originalimage.source : (data.thumbnail ? data.thumbnail.source : null);
            if(src) {
                img.src = src;
                img.onload = () => { loader.style.display = 'none'; };
            } else {
                loader.style.display = 'none';
                img.alt = "No Image";
            }
        } else {
            loader.style.display = 'none';
            desc.innerText = "è³‡æ–™è®€å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šã€‚";
        }
    }


    // --- Modal ---
    async function openModal(plant) {
        const modal = document.getElementById('modal');
        const img = document.getElementById('m-img');
        const loader = document.getElementById('m-loader');
        
        modal.style.display = 'flex';
        img.style.display = 'none';
        loader.style.display = 'block';
        document.getElementById('m-err').style.display = 'none';
        document.getElementById('m-name').innerText = plant.name;
        document.getElementById('m-latin').innerText = plant.eng;
        document.getElementById('m-desc').innerText = "é€£ç·šç™¾ç§‘ä¸­...";
        document.getElementById('m-wiki').href = `https://zh.wikipedia.org/wiki/${plant.wikiTerm || plant.name}`;
        
        const badge = document.getElementById('m-status');
        badge.innerText = plant.status;
        badge.className = `status-badge ${getStatusClass(plant.status)}`;

        const data = await getWikiData(plant.name, plant.wikiTerm);
        if(data) {
            document.getElementById('m-desc').innerText = data.extract || "ç„¡è©³ç´°æ‘˜è¦";
            const src = data.originalimage ? data.originalimage.source : (data.thumbnail ? data.thumbnail.source : null);
            if(src) {
                img.src = src;
                img.onload = () => { loader.style.display='none'; img.style.display='block'; };
            } else {
                loader.style.display='none';
                document.getElementById('m-err').style.display='block';
            }
        } else {
            loader.style.display='none';
            document.getElementById('m-desc').innerText = "è³‡æ–™è®€å–å¤±æ•—ã€‚";
        }
    }

    function closeModal(e) {
        if(!e || e.target.id === 'modal') {
            document.getElementById('modal').style.display = 'none';
        }
    }

    // --- Quiz ---
    let gameState = { pool: [], queue: [], idx: 0, score: 0, answering: false };
    let retryCount = 0;

    function startQuiz() {
        let pool = [...plants].sort(() => Math.random() - 0.5);
        gameState = { pool: pool, queue: pool.slice(0, 10), idx: 0, score: 0, answering: false };
        retryCount = 0;
        document.getElementById('quiz-menu').style.display = 'none';
        document.getElementById('quiz-result').style.display = 'none';
        document.getElementById('quiz-play').style.display = 'block';
        document.getElementById('q-score').innerText = 0;
        loadQuestion();
    }

    async function loadQuestion() {
        if(gameState.idx >= 10) { finishQuiz(); return; }
        
        const plant = gameState.queue[gameState.idx];
        gameState.answering = true;

        document.getElementById('q-progress').innerText = `${gameState.idx+1} / 10`;
        document.getElementById('reveal-card').style.display = 'none';
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('feedback').innerText = '';
        document.getElementById('skip-indicator').style.display = 'none';
        document.getElementById('q-img').style.display = 'none';
        document.getElementById('v-loader').style.display = 'block';

        const data = await getWikiData(plant.name, plant.wikiTerm);
        const src = data && (data.originalimage ? data.originalimage.source : (data.thumbnail ? data.thumbnail.source : null));
        if(!src) {
            handleSkip();
            return;
        }

        const img = document.getElementById('q-img');
        img.src = src;
        img.onload = () => {
            document.getElementById('v-loader').style.display = 'none';
            img.style.display = 'block';
            retryCount = 0;
        };
        img.onerror = () => { handleSkip(); }

        let opts = [plant];
        let pool = plants.filter(p => p.name !== plant.name);
        for(let i=0; i<3; i++) opts.push(pool.splice(Math.floor(Math.random() * pool.length), 1)[0]);
        opts.sort(() => Math.random() - 0.5);
        document.getElementById('opt-container').innerHTML = opts.map(p => 
            `<button class="opt-btn" onclick="checkAnswer(this, '${p.name}')">${p.name}</button>`
        ).join('');
    }

    function handleSkip() {
        retryCount++;
        if(retryCount > 10) {
            alert("ç¶²è·¯ç‹€æ³ä¸ä½³ï¼Œåœ–ç‰‡è®€å–å›°é›£");
            quitQuiz();
            return;
        }
        let replacementIndex = 10 + retryCount;
        if(replacementIndex < gameState.pool.length) {
            gameState.queue[gameState.idx] = gameState.pool[replacementIndex];
            document.getElementById('skip-indicator').style.display = 'block';
            loadQuestion();
        } else {
            finishQuiz();
        }
    }

    function checkAnswer(btn, name) {
        if(!gameState.answering) return;
        gameState.answering = false;
        
        const correct = gameState.queue[gameState.idx];
        const isRight = name === correct.name;
        if(isRight) {
            btn.classList.add('correct');
            document.getElementById('feedback').innerText = "â­• ç­”å°äº†ï¼";
            document.getElementById('feedback').style.color = "green";
            gameState.score += 10;
        } else {
            btn.classList.add('wrong');
            document.getElementById('feedback').innerText = `âŒ æ˜¯ï¼š${correct.name}`;
            document.getElementById('feedback').style.color = "red";
            document.querySelectorAll('.opt-btn').forEach(b => {
                if(b.innerText === correct.name) b.classList.add('correct');
            });
        }
        document.getElementById('q-score').innerText = gameState.score;
        document.getElementById('next-btn').style.display = 'block';

        const rev = document.getElementById('reveal-card');
        rev.style.display = 'block';
        document.getElementById('rev-name').innerText = correct.name;
        document.getElementById('rev-link').href = `https://zh.wikipedia.org/wiki/${correct.wikiTerm || correct.name}`;
        
        const badge = document.getElementById('rev-status');
        badge.innerText = correct.status;
        badge.className = `status-badge ${getStatusClass(correct.status)}`;

        getWikiData(correct.name, correct.wikiTerm).then(d => document.getElementById('rev-desc').innerText = d ? d.extract : "ç„¡è³‡æ–™");
    }

    function nextQuestion() {
        gameState.idx++;
        loadQuestion();
    }

    function finishQuiz() {
        document.getElementById('quiz-play').style.display = 'none';
        document.getElementById('quiz-result').style.display = 'block';
        document.getElementById('final-score').innerText = gameState.score;
        
        let rank = "";
        if(gameState.score === 100) rank = "ğŸŒ² æ£®æ—ä¹‹ç¥";
        else if(gameState.score >= 80) rank = "ğŸŒ¿ ç¶ æ‰‹æŒ‡é”äºº";
        else if(gameState.score >= 60) rank = "ğŸŒ¸ æ„›èŠ±äººå£«";
        else rank = "ğŸŒ± æ¤ç‰©æ–°æ‰‹";
        document.getElementById('final-rank').innerText = rank;
    }

    function quitQuiz() {
        document.getElementById('quiz-play').style.display = 'none';
        document.getElementById('quiz-result').style.display = 'none';
        document.getElementById('quiz-menu').style.display = 'block';
    }
</script>

</body>
</html>
